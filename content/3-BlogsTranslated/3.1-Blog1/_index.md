---
title: "How FINRA established real-time operational observability for big data workloads on Amazon EMR running on Amazon EC2 with Prometheus and Grafana"
date: 2024-11-15
weight: 10
chapter: false
pre: " <b> 3.1. </b> "
---

Post date: Nov 15, 2024 – Authors: Sumalatha Bachu, PremKiran Bejjam, and Akhil Chalamalasetty in [AWS Big Data](https://aws.amazon.com/blogs/big-data/category/big-data/), [Customer Solutions](https://aws.amazon.com/blogs/big-data/category/post-types/customer-solutions/), [Monitoring and observability](https://aws.amazon.com/blogs/big-data/category/management-and-governance/monitoring-and-observability/).

This is a guest post by FINRA (Financial Industry Regulatory Authority). FINRA is dedicated to protecting investors and safeguarding market integrity in a manner that facilitates vibrant capital markets.

[FINRA](https://www.finra.org/) processes big data with massive volumes and workloads of varying sizes and instance types on [Amazon EMR](http://aws.amazon.com/emr). Amazon EMR is a cloud big data environment designed for processing large amounts of data using open-source tools such as Hadoop, Spark, HBase, Flink, Hudi, and Presto.

Monitoring EMR clusters is essential to detect critical issues with applications, infrastructure, or data in real time. A fine-tuned monitoring system helps quickly identify root causes, automate remediation, minimize manual tasks, and increase productivity. Additionally, observing cluster performance and utilization over time helps operations and engineering teams find potential performance bottlenecks and optimization opportunities to right-size their clusters. This, in turn, reduces manual tasks and improves service level agreement (SLA) compliance.

In this post, we discuss our challenges and show how we built an observability framework to provide insights into operational metrics for big data workloads on Amazon EMR clusters running on [Amazon Elastic Compute Cloud](http://aws.amazon.com/ec2) (Amazon EC2).

---

**Challenges**

In today’s data-centric world, organizations strive to extract valuable insights from massive amounts of data. The challenge we faced was finding an effective way to monitor and observe big data workloads on Amazon EMR due to their complexity. Monitoring and observing Amazon EMR solutions come with various challenges:

* **Complexity and scale** – EMR clusters often process massive amounts of data across multiple nodes. Monitoring such a distributed and complex system requires handling high data throughput and minimizing performance impact. Managing and interpreting the large volume of monitoring data generated by EMR clusters can be overwhelming, making it difficult to identify and troubleshoot issues promptly.
* **Dynamic environments** – EMR clusters are often ephemeral, created and terminated based on workload requirements. This dynamic nature makes it difficult to monitor, collect metrics, and maintain consistent observability over time.
* **Data diversity** – Monitoring cluster health and having a bird's-eye view to detect bottlenecks, anomalous behavior in processing, data skew, and job performance is critical. Detailed observability of long-running clusters, nodes, tasks, potential data skew, stuck tasks, performance issues, and job-level metrics (such as Spark and JVM) is crucial to understand. Achieving comprehensive observability across these diverse data types is difficult.
* **Resource optimization** – EMR clusters consist of multiple components and services working together, making it challenging to effectively monitor all aspects of the system. Monitoring resource utilization (CPU, memory, disk I/O) across multiple nodes to prevent bottlenecks and inefficiencies is essential but complex, especially in a distributed environment.
* **Latency and performance metrics** – Collecting and analyzing latency and comprehensive performance metrics in real time to identify and resolve issues promptly is critical but challenging due to the distributed nature of Amazon EMR.
* **Centralized observability dashboard** – Having a single pane of glass for all aspects of EMR cluster metrics, including cluster health, resource utilization, job execution, logs, and security, to provide a complete picture of system performance and health, is a challenge.
* **Alerting and incident management** – Setting up effective centralized alerting and notification systems is difficult. Configuring alerts for critical events or performance thresholds requires careful consideration to avoid "alert fatigue" while ensuring critical issues are addressed promptly. Responding to incidents from performance slowdowns or interruptions takes time and effort to detect and fix without proper alerting mechanisms.
* **Cost management** – Finally, optimizing costs while maintaining effective monitoring is an ongoing challenge. Balancing the need for comprehensive monitoring with cost constraints requires careful planning and optimization strategies to avoid unnecessary expenses while ensuring adequate monitoring capabilities.

Effective observability for Amazon EMR requires a combination of the right tools, practices, and strategies to address these challenges, thereby delivering big data processing that is reliable, efficient, and cost-effective.

The [Ganglia](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-ganglia.html) system on Amazon EMR was designed to monitor the health of the entire cluster and all nodes, displaying various metrics such as Hadoop, Spark, and JVM. When viewing the Ganglia web interface in a browser, we see an overview of the EMR cluster's performance, details on load, memory usage, CPU usage, and network traffic via various graphs.

However, with AWS announcing the deprecation of Ganglia support for [AWS for higher versions of Amazon EMR](https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-ganglia.html), it became critical for FINRA to build this solution.

---

**Solution Overview**

Insights drawn from the post [Monitor and Optimize Analytic Workloads on Amazon EMR with Prometheus and Grafana](https://aws.amazon.com/blogs/big-data/monitor-and-optimize-analytic-workloads-on-amazon-emr-with-prometheus-and-grafana/) inspired our approach. This article demonstrated how to set up a monitoring system using [Amazon Managed Service for Prometheus](https://aws.amazon.com/prometheus/) and [Amazon Managed Grafana](https://aws.amazon.com/grafana/) to effectively monitor an EMR cluster, using Grafana dashboards to view metrics for troubleshooting and optimizing performance issues.

Based on these insights, we completed a successful proof of concept. Next, we built a centralized monitoring solution for our enterprise with Managed Prometheus and Managed Grafana to simulate Ganglia-like metrics at FINRA. Managed Prometheus allows for real-time high-volume data collection, scalable ingestion, storage, and querying of operational metrics as workloads scale up or down. These metrics are forwarded to a Managed Grafana workspace for visualization.

Our solution includes an ingestion layer for every cluster, configured to collect metrics via a custom script stored in [Amazon Simple Storage Service](http://aws.amazon.com/s3). We also installed Managed Prometheus at launch for EC2 instances on Amazon EMR via a bootstrap script. Additionally, application-specific tags are defined in the configuration file to optimize the ingestion and collection of specific metrics.

Once Managed Prometheus (installed on EMR clusters) collects the metrics, they are sent to a remote Managed Prometheus workspace. Managed Prometheus workspaces are logical and isolated environments dedicated to Managed Prometheus servers, managing specific metrics. They also provide access control to authorize who or what can send and receive metrics from that workspace. You can create one or more workspaces by account or application depending on needs, facilitating better management.

After the metrics are collected, we built a mechanism to display them on Managed Grafana dashboards, which are then consumed via an endpoint. We customized dashboards for task-level, node-level, and cluster-level metrics so they could be promoted from lower environments to higher ones. We also built several sample dashboards displaying node-level metrics such as OS-level metrics (CPU, memory, network, disk I/O), HDFS metrics, YARN metrics, Spark metrics, and job-level metrics (Spark and JVM), maximizing potential for each environment through automatic metric aggregation within each account.

We chose SAML-based authentication, allowing us to integrate with existing Active Directory (AD) groups, minimizing the effort required to manage user access and granting Grafana dashboard access based on user roles. We organized three main groups—admins, editors, and viewers—to authenticate Grafana users based on their roles.

Through complex monitoring automation, these desired metrics are pushed to [Amazon CloudWatch](https://aws.amazon.com/cloudwatch/). We use CloudWatch for alerting when necessary, whenever metrics exceed desired thresholds.

![Solution Architecture Diagram](/images/3-BlogsTranslated/Blog_FINRA/img1.jpg)

---

## **Sample Dashboards**

The following screenshots introduce the sample dashboards.

![Sample Dashboard 1](/images/3-BlogsTranslated/Blog_FINRA/img2.jpg)

![Sample Dashboard 2](/images/3-BlogsTranslated/Blog_FINRA/img3.jpg)

---

**Conclusion**

In this post, we shared how FINRA enhanced data-driven decision-making with comprehensive workload observability on EMR, aiming to optimize performance, maintain reliability, and gain critical insights into big data operations, leading to operational excellence.

FINRA's solution allowed operations and engineering teams to use a "single pane of glass" to monitor big data workloads and quickly detect any operational issues. This scalable solution significantly reduced troubleshooting time and improved our overall operational capabilities. The solution provided operations and engineering teams with comprehensive insights into various Amazon EMR metrics such as OS levels, Spark, JMX, HDFS, and YARN, all aggregated in a single place. We also extended this solution to use cases like [Amazon Elastic Kubernetes Service](https://aws.amazon.com/eks/) (Amazon EKS) clusters, including EMR on EKS and other applications, making it a unified system for monitoring metrics across our entire infrastructure and applications.

---

| ![Sumalatha Bachu](/images/3-BlogsTranslated/Blog_FINRA/author1.png) | **Sumalatha Bachu** <br> Sumalatha is a Senior Director of Technology at FINRA. She oversees Big Data Operations, including managing petabyte-scale data and handling complex workloads on the cloud platform. Additionally, she is an expert in developing Enterprise Application Monitoring and Observability Solutions, Operational Data Analytics, and Machine Learning Model Governance processes. Outside of work, she enjoys yoga, singing practice, and teaching in her spare time. |
| :---- | :---- |
| ![PremKiran Bejjam](/images/3-BlogsTranslated/Blog_FINRA/author2.jpg) | **PremKiran Bejjam** <br> PremKiran is a Lead Engineer Consultant at FINRA. He specializes in developing resilient and scalable systems. With a strong focus on designing monitoring solutions to enhance infrastructure reliability, he is dedicated to optimizing system performance. Outside of work, he enjoys spending quality time with family and constantly seeking new learning opportunities. |
| ![Akhil Chalamalasetty](/images/3-BlogsTranslated/Blog_FINRA/author3.png) | **Akhil Chalamalasetty** <br> Akhil is a Director of Market Regulation Technology at FINRA. He is a Big Data expert, specializing in building advanced large-scale solutions, along with optimizing workloads, data, and their processing capabilities. Akhil enjoys sim racing and watching Formula 1 in his spare time. |